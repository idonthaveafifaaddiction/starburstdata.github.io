

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>7.5. Presto Kubernetes Resource &mdash; Starburst Distribution of Presto 323-e.6 Documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Distribution of Presto 323-e.6 Documentation" href="../index.html"/>
        <link rel="up" title="7. Presto on Kubernetes" href="../kubernetes.html"/>
        <link rel="next" title="7.6. Querying Presto" href="query.html"/>
        <link rel="prev" title="7.4. Prerequisites" href="prerequisites.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Distribution of Presto
          

          
          </a>

          
            
            
              <div class="version">
                323-e.6
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../system-requirements.html">2. Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mission-control.html">3. Mission Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker.html">4. Running Presto in a Docker container</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">5. Presto on Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../azure.html">6. Presto on Microsoft Azure</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../kubernetes.html">7. Presto on Kubernetes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">7.1. Getting Started: A Quick Guide to Presto on Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="online_deploy.html">7.2. Deploy Presto on Kubernetes from DockerHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">7.3. Overview of Presto on Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">7.4. Prerequisites</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">7.5. Presto Kubernetes Resource</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-properties">General properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#service-properties">Service properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#presto-coordinator-properties">Presto Coordinator properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#presto-worker-properties">Presto Worker properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#general-memory-properties">General memory properties</a></li>
<li class="toctree-l3"><a class="reference internal" href="#hive-connector-properties">Hive connector properties</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#external-metastore">External Metastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#internal-metastore">Internal Metastore</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-internal-metastore-with-custom-s3-endpoints">Using internal Metastore with custom S3 endpoints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-aws-credentials">Using AWS credentials</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-azure-storage-account-key-to-access-azure-blob">Using Azure Storage account key to access Azure Blob</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-azure-storage-account-key-to-access-adls-gen-2">Using Azure Storage account key to access ADLS Gen 2</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-azure-credentials-to-access-adls-gen-1">Using Azure credentials to access ADLS Gen 1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-google-service-account-key">Using Google Service Account key</a></li>
<li class="toctree-l4"><a class="reference internal" href="#specifying-additional-hive-connector-properties">Specifying additional Hive connector properties</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-internal-hive-metastore-pod">Customizing internal Hive Metastore pod</a></li>
<li class="toctree-l4"><a class="reference internal" href="#customizing-internal-postgresql-docker-pod">Customizing internal PostgreSQL Docker pod</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#prometheus-support">Prometheus support</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="query.html">7.6. Querying Presto</a></li>
<li class="toctree-l2"><a class="reference internal" href="gke.html">7.7. Presto on Google Kubernetes Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="customizing_presto_image.html">7.8. Customizing The Presto Docker Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="hpa.html">7.9. Horizontal scaling of a Presto cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html">7.10. Release notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation-rpm.html">8. Presto RPM Installation using Presto Admin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation/deployment.html">9. Presto Tarball Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../client.html">10. Presto Client Software</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">11. Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">12. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">13. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">14. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">15. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">16. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">17. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">18. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">19. Older Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">20. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">21. Release Notes</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Starburst Distribution of Presto</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../kubernetes.html">7. Presto on Kubernetes</a> &raquo;</li>
      
    <li>7.5. Presto Kubernetes Resource</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="../_sources/kubernetes/presto_resource.rst.txt" rel="nofollow"> View page source</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="presto-kubernetes-resource">
<h1>7.5. Presto Kubernetes Resource</h1>
<p>Presto Kubernetes resources constitute particular Presto clusters.
Each such a resource represents a single Presto cluster.
A Presto Kubernetes resource YAML allows specifying various
properties related to the Presto server, Presto connectors and Kubernetes.
Properties are defined in the <code class="code docutils literal"><span class="pre">spec</span></code> section of Presto Kubernetes resource YAML.
The following snippet shows the structure of a Presto Kubernetes Resource YAML
including all available properties (with defaults). When defining your particular
Presto cluster resource you need to specify <em>only</em> the properties with non-default values.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">apiVersion</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">starburstdata.com/v1</span>
<span class="l l-Scalar l-Scalar-Plain">kind</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">Presto</span>
<span class="l l-Scalar l-Scalar-Plain">metadata</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">presto-cluster-name</span>
<span class="l l-Scalar l-Scalar-Plain">spec</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">nameOverride</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">clusterDomain</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">cluster.local</span>
  <span class="l l-Scalar l-Scalar-Plain">environment</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalJvmConfigProperties</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalCatalogs</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalEtcPrestoTextFiles</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalEtcPrestoBinaryFiles</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">licenseSecretName</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">imageNamePrefix</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalBootstrapScriptVolume</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalBootstrapScriptVolumes</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>

  <span class="l l-Scalar l-Scalar-Plain">prometheus</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
    <span class="l l-Scalar l-Scalar-Plain">additionalRules</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>

  <span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">ClusterIP</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">additionalSpecProperties</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">nodePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">31234</span>

  <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">starburstdata/presto</span>
    <span class="l l-Scalar l-Scalar-Plain">pullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
    <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">323-e.1-k8s-0.18</span>

  <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">nodeMemoryHeadroom</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
    <span class="l l-Scalar l-Scalar-Plain">xmxToTotalMemoryRatio</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.9</span>
    <span class="l l-Scalar l-Scalar-Plain">heapHeadroomPerNodeRatio</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.3</span>
    <span class="l l-Scalar l-Scalar-Plain">queryMaxMemory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1Pi</span>
    <span class="l l-Scalar l-Scalar-Plain">queryMaxTotalMemoryPerNodePoolFraction</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.333</span>

  <span class="l l-Scalar l-Scalar-Plain">coordinator</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">cpuLimit</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">cpuRequest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="l l-Scalar l-Scalar-Plain">memoryAllocation</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">60Gi</span>
    <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">affinity</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">additionalProperties</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>

  <span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
    <span class="l l-Scalar l-Scalar-Plain">autoscaling</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
      <span class="l l-Scalar l-Scalar-Plain">minReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
      <span class="l l-Scalar l-Scalar-Plain">maxReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
      <span class="l l-Scalar l-Scalar-Plain">targetCPUUtilizationPercentage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
    <span class="l l-Scalar l-Scalar-Plain">deploymentTerminationGracePeriodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7200</span> <span class="c1"># 2 hours</span>
    <span class="l l-Scalar l-Scalar-Plain">cpuLimit</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">cpuRequest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">16</span>
    <span class="l l-Scalar l-Scalar-Plain">memoryAllocation</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100Gi</span>
    <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">affinity</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
    <span class="l l-Scalar l-Scalar-Plain">additionalProperties</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>

  <span class="l l-Scalar l-Scalar-Plain">readinessProbe</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">initialDelaySeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="l l-Scalar l-Scalar-Plain">periodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
    <span class="l l-Scalar l-Scalar-Plain">timeoutSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>

  <span class="l l-Scalar l-Scalar-Plain">livenessProbe</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">initialDelaySeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
    <span class="l l-Scalar l-Scalar-Plain">periodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
    <span class="l l-Scalar l-Scalar-Plain">failureThreshold</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">timeoutSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>

  <span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">metastoreUri</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">awsSecretName</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">googleServiceAccountKeySecretName</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">azureAbfsSecretName</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">azureAdlSecretName</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">additionalProperties</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
    <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">mySql</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">jdbcUrl</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">postgreSql</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">jdbcUrl</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
        <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">internalPostgreSql</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">false</span>
        <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">postgres</span>
          <span class="l l-Scalar l-Scalar-Plain">pullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
          <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">9.6.10</span>
        <span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">className</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1Gi</span>
          <span class="l l-Scalar l-Scalar-Plain">claimSelector</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
        <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
        <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
        <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
        <span class="l l-Scalar l-Scalar-Plain">affinity</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
      <span class="l l-Scalar l-Scalar-Plain">s3Endpoint</span><span class="p p-Indicator">:</span> <span class="s">&quot;&quot;</span>
      <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">starburstdata/hive-metastore</span>
        <span class="l l-Scalar l-Scalar-Plain">pullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
        <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">k8s-0.5</span>
      <span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">6Gi</span>
      <span class="l l-Scalar l-Scalar-Plain">cpu</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
      <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
      <span class="l l-Scalar l-Scalar-Plain">affinity</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">{}</span>
</pre></div>
</div>
<div class="section" id="general-properties">
<h2>General properties</h2>
<table border="1" class="docutils">
<colgroup>
<col width="32%" />
<col width="36%" />
<col width="31%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property name</th>
<th class="head">Example</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td rowspan="2"><blockquote class="first">
<div>nameOverride</div></blockquote>
<dl class="last docutils">
<dt>-–––————————————-</dt>
<dd>clusterDomain</dd>
</dl>
</td>
<td><code class="code docutils literal"><span class="pre">nameOverride:</span> <span class="pre">presto-cluster</span></code></td>
<td>Presto Operator by default assigns
a unique name to various
Kubernetes resources (e.g. Services).
The name
consists of the cluster name and a
unique suffix. Use this
property to assign a static
name instead.</td>
</tr>
<tr class="row-odd"><td><code class="code docutils literal"><span class="pre">clusterDomain:</span> <span class="pre">cluster-domain.example</span></code></td>
<td>Domain of the K8s cluster.</td>
</tr>
<tr class="row-even"><td>environment</td>
<td><code class="code docutils literal"><span class="pre">environment:</span> <span class="pre">production</span></code></td>
<td>The name of the Presto cluster
environment.</td>
</tr>
<tr class="row-odd"><td>licenseSecretName</td>
<td><code class="code docutils literal"><span class="pre">licenseSecretName:</span> <span class="pre">license_secret</span></code></td>
<td>Name of a Kubernetes Secret that
contains a Presto license file.
The license file within the secret
should be named <code class="code docutils literal"><span class="pre">signed.license</span></code>.</td>
</tr>
<tr class="row-even"><td>imageNamePrefix</td>
<td><code class="code docutils literal"><span class="pre">imageNamePrefix:</span> <span class="pre">gcr.io/project-name/</span></code></td>
<td>Specifies prefix of Docker image names
used by the Presto cluster. This
property enables using a private Docker
registry.</td>
</tr>
<tr class="row-odd"><td>image</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">starburstdata/presto-customized</span>
  <span class="l l-Scalar l-Scalar-Plain">pullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
  <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">323-e.1-k8s-0.18</span>
</pre></div>
</div>
</td>
<td>Image section allows you to specify
a custom Docker image to be used by
Presto cluster.</td>
</tr>
<tr class="row-even"><td>readinessProbe</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">readinessProbe</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">initialDelaySeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="l l-Scalar l-Scalar-Plain">periodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">5</span>
  <span class="l l-Scalar l-Scalar-Plain">timeoutSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
</pre></div>
</div>
</td>
<td>Properties of Presto Coordinator
and Worker readiness probes.
For more information on readiness
probes, refer to <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Kubernetes probes</a>.</td>
</tr>
<tr class="row-odd"><td>livenessProbe</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">livenessProbe</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">initialDelaySeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
  <span class="l l-Scalar l-Scalar-Plain">periodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
  <span class="l l-Scalar l-Scalar-Plain">failureThreshold</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
  <span class="l l-Scalar l-Scalar-Plain">timeoutSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
</pre></div>
</div>
</td>
<td>Properties of Presto Coordinator
and Worker liveness probes.
For more information on liveness
probes, refer to <a class="reference external" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-probes/">Kubernetes probes</a>.</td>
</tr>
<tr class="row-even"><td>additionalBootstrapScriptVolume</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">additionalBootstrapScriptVolume</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bootstrap-script</span>
</pre></div>
</div>
</td>
<td>Property of Presto Coordinator
and Worker pod. Allows adding a custom
bootstrap script to customize the
Presto pods. Executed prior to staring
Presto on the pod. Refer to
<a class="reference internal" href="customizing_presto_image.html#k8s-custom-bootstrap"><span class="std std-ref">Custom Bootstrap Script</span></a></td>
</tr>
<tr class="row-odd"><td>additionalBootstrapScriptVolumes</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">additionalBootstrapScriptVolumes</span><span class="p p-Indicator">:</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bootstrap-script-1</span>
  <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">configMap</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">my-bootstrap-script-2</span>
</pre></div>
</div>
</td>
<td>Property of Presto Coordinator
and Worker pod. Allows adding a custom
bootstrap scripts to customize the
Presto pods. Executed prior to staring
Presto on the pod. Refer to
<a class="reference internal" href="customizing_presto_image.html#k8s-custom-bootstrap"><span class="std std-ref">Custom Bootstrap Script</span></a></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="service-properties">
<span id="service"></span><h2>Service properties</h2>
<p>Access to Presto Coordinator is possible via the Kubernetes Service.
By default the service is only accessible within the Kubernetes cluster
at <code class="code docutils literal"><span class="pre">http://presto-coordinator-CLUSTER_NAME_UUID.NAMESPACE.svc.cluster.local:8080</span></code>,
where <code class="code docutils literal"><span class="pre">NAMESPACE</span></code> is the Kubernetes namespace where the given Presto cluster
is deployed and <code class="code docutils literal"><span class="pre">CLUSTER_NAME_UUID</span></code> is the cluster name with unique suffix appended.</p>
<p>Use the <code class="code docutils literal"><span class="pre">service.name</span></code> Presto resource parameter to make
the service name more predictable. For example setting
<code class="code docutils literal"><span class="pre">service.name=test-cluster</span></code> will cause the Presto Coordinator service
address to be <code class="code docutils literal"><span class="pre">http://presto-coordinator-test-cluster.NAMESPACE.svc.cluster.local:8080</span></code>.</p>
<p>Use the <code class="code docutils literal"><span class="pre">nameOverride</span></code> parameter in order to set <code class="code docutils literal"><span class="pre">CLUSTER_NAME_UUID</span></code>
to a different value.</p>
<p>You can also change type of the Presto Coordinator Service using the <code class="code docutils literal"><span class="pre">service.type</span></code> parameter.
For more information on Kubernetes Service types, refer to <a class="reference external" href="https://kubernetes.io/docs/concepts/services-networking/service/#publishing-services-service-types">Kubernetes Services types</a>.</p>
<p>You can add additional parameters to <em>spec</em> section of Service by using
<code class="code docutils literal"><span class="pre">service.additionalSpecProperties</span></code> Presto resource parameter, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalSpecProperties</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">loadBalancerIP</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">78.11.24.19</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">LoadBalancer</span>
</pre></div>
</div>
<p>Use <code class="code docutils literal"><span class="pre">service.nodePort</span></code> parameter to specify the port on which Presto Coordinator
Service should be exposed when <code class="code docutils literal"><span class="pre">service.type</span></code> is set to <code class="code docutils literal"><span class="pre">NodePort</span></code>, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">service</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">type</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">NodePort</span>
  <span class="l l-Scalar l-Scalar-Plain">nodePort</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3001</span>
</pre></div>
</div>
</div>
<div class="section" id="presto-coordinator-properties">
<h2>Presto Coordinator properties</h2>
<table border="1" class="docutils">
<colgroup>
<col width="28%" />
<col width="39%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property name</th>
<th class="head">Example</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><p class="first">coordinator.cpuRequest</p>
<p class="last">coordinator.cpuLimit</p>
</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">coordinator</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">cpuRequest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
  <span class="l l-Scalar l-Scalar-Plain">cpuLimit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
</pre></div>
</div>
</td>
<td>Specifies the Presto Coordinator pod’s
CPU limit and request.</td>
</tr>
<tr class="row-odd"><td>coordinator.memoryAllocation</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">coordinator</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">memoryAllocation</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">60Gi</span>
</pre></div>
</div>
</td>
<td>Specifies Presto Coordinator pod’s
memory usage (both request and limit).
If empty Presto Coordinator pod will
utilize entire memory available on the
node.</td>
</tr>
<tr class="row-even"><td>coordinator.additionalProperties</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">coordinator</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalProperties</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
    <span class="no">resource-groups.config-file=filename</span>
</pre></div>
</div>
</td>
<td>Specifies additional
<code class="code docutils literal"><span class="pre">config.properties</span></code> properties.</td>
</tr>
<tr class="row-odd"><td><p class="first">coordinator.nodeSelector</p>
<p class="last">coordinator.affinity</p>
</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">coordinator</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">presto</span>
  <span class="l l-Scalar l-Scalar-Plain">affinity</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">podAffinity</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</td>
<td>Specifies Presto Coordinator pod’s node
selector and affinity.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="presto-worker-properties">
<h2>Presto Worker properties</h2>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="38%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property name</th>
<th class="head">Example</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>worker.count</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">3</span>
</pre></div>
</div>
</td>
<td>Number of Presto worker pods.</td>
</tr>
<tr class="row-odd"><td>worker.autoscaling</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">autoscaling</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">minReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">maxReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="l l-Scalar l-Scalar-Plain">targetCPUUtilizationPercentage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
</pre></div>
</div>
</td>
<td>Configuration of Presto Workers
autoscaling.</td>
</tr>
<tr class="row-even"><td>worker.deploymentTerminationGracePeriodSeconds</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">deploymentTerminationGracePeriodSeconds</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">7200</span>
</pre></div>
</div>
</td>
<td>Specifies termination grace period
for Presto Workers pods. Presto Worker
pods won’t be terminated until queries
running on the pod are finished or
grace period passes.</td>
</tr>
<tr class="row-odd"><td><p class="first">worker.cpuRequest</p>
<p class="last">worker.cpuLimit</p>
</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">coordinator</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">cpuRequest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">6</span>
  <span class="l l-Scalar l-Scalar-Plain">cpuLimit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">32</span>
</pre></div>
</div>
</td>
<td>Specifies Presto Worker pod
CPU limit and request.</td>
</tr>
<tr class="row-even"><td>worker.memoryAllocation</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">memoryAllocation</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100Gi</span>
</pre></div>
</div>
</td>
<td>Specifies Presto Worker pod memory
usage (both request and limit).
If empty Presto Worker pod will
utilize entire memory available on the
node.</td>
</tr>
<tr class="row-odd"><td>worker.additionalProperties</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalProperties</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
    <span class="no">resource-groups.config-file=filename</span>
</pre></div>
</div>
</td>
<td>Specifies additional
<code class="code docutils literal"><span class="pre">config.properties</span></code> properties.</td>
</tr>
<tr class="row-even"><td><p class="first">worker.nodeSelector</p>
<p class="last">worker.affinity</p>
</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">nodeSelector</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">presto</span>
  <span class="l l-Scalar l-Scalar-Plain">affinity</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">podAffinity</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">...</span>
</pre></div>
</div>
</td>
<td>Specifies Presto Worker pod’s node
selector and affinity.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="general-memory-properties">
<h2>General memory properties</h2>
<p><code class="code docutils literal"><span class="pre">memory</span></code> section specifies general Presto memory configuration</p>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="36%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property name</th>
<th class="head">Example</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>memory.nodeMemoryHeadroom</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">nodeMemoryHeadroom</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2Gi</span>
</pre></div>
</div>
</td>
<td>Memory headroom that Presto should
leave on a node when Presto pods
are configured to use entire node
memory (empty <code class="code docutils literal"><span class="pre">memoryAllocation</span></code>
configuration property).</td>
</tr>
<tr class="row-odd"><td>memory.xmxToTotalMemoryRatio</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">xmxToTotalMemoryRatio</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.9</span>
</pre></div>
</div>
</td>
<td>Ratio between Presto JVM heap size
and memory available for a Presto pod.</td>
</tr>
<tr class="row-even"><td>memory.heapHeadroomPerNodeRatio</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">heapHeadroomPerNodeRatio</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.3</span>
</pre></div>
</div>
</td>
<td>Ratio between
<code class="code docutils literal"><span class="pre">memory.heap-headroom-per-node</span></code>
Presto configuration property and
Presto JVM heap size.</td>
</tr>
<tr class="row-odd"><td>memory.queryMaxMemory</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">queryMaxMemory</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1Pi</span>
</pre></div>
</div>
</td>
<td>Value of the <code class="code docutils literal"><span class="pre">query.max-memory</span></code>
Presto configuration property.</td>
</tr>
<tr class="row-even"><td>memory.queryMaxTotalMemoryPerNodePoolFraction</td>
<td><div class="first last highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">memory</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">queryMaxTotalMemoryPerNodePoolFraction</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.333</span>
</pre></div>
</div>
</td>
<td>Value the
<code class="code docutils literal"><span class="pre">query.max-total-memory-per-node</span></code>
Presto configuration property expressed
as fraction of Presto JVM heap size.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="hive-connector-properties">
<h2>Hive connector properties</h2>
<p>Starburst Presto on Kubernetes provides automatic configuration of the Hive connector.
Such a connector allows you to either access an external Metastore or use built-in
internal Presto cluster Metastore as well.</p>
<div class="section" id="external-metastore">
<h3>External Metastore</h3>
<p>You can configure Presto to use an external Hive Metastore by setting the
<code class="code docutils literal"><span class="pre">hive.metastoreUri</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">metastoreUri</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">thrift://hive-metastore:9083</span>
</pre></div>
</div>
</div>
<div class="section" id="internal-metastore">
<h3>Internal Metastore</h3>
<p>You can configure Presto to use an internal Hive Metastore by setting the
<code class="code docutils literal"><span class="pre">hive.internalMetastore.mySql</span></code> or <code class="code docutils literal"><span class="pre">hive.internalMetastore.postgreSql</span></code> properties, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">mySql</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">jdbcUrl</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jdbc:mysql://mysql-server/metastore-database</span>
      <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hive</span>
      <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hivePassword</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">postgreSql</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">jdbcUrl</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">jdbc:postgresql://postgresql-server/metastore-database</span>
      <span class="l l-Scalar l-Scalar-Plain">username</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hive</span>
      <span class="l l-Scalar l-Scalar-Plain">password</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">hivePassword</span>
</pre></div>
</div>
<p>In such a case, an additional Hive Metastore pod will be
created which will store data in the provided PostgreSQL
or MySQL database.</p>
<p>You can also make the internal Metastore to use an internal
ephemeral PostgreSQL database. This can be enabled by setting the
<code class="code docutils literal"><span class="pre">hive.internalMetastore.internalPostgreSql.enabled</span></code> to <code class="code docutils literal"><span class="pre">true</span></code>, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">internalPostgreSql</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
</pre></div>
</div>
<p>In this case, an additional PostgreSQL pod will be created
along with the Hive Metastore pod. This Hive Metastore will use
the internal ephemeral PostgreSQL as a relational database.</p>
<p><strong>Note:</strong> Using the internal ephemeral PostgreSQL is not recommended for
production. Data stored within the internal PostgreSQL will be
lost when the Presto cluster is terminated.</p>
<p><strong>Note:</strong> You cannot use external and internal Metastore at the same time.
You also cannot use external and internal relational database
for Metastore at the same time.</p>
</div>
<div class="section" id="using-internal-metastore-with-custom-s3-endpoints">
<h3>Using internal Metastore with custom S3 endpoints</h3>
<p>It possible to configure an internal Metastore with S3 like
data sources. You can specify a custom S3 endpoint via the
<code class="code docutils literal"><span class="pre">hive.internalMetastore.s3Endpoint</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">s3Endpoint</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">http://my-custom-s3-endpoint</span>
</pre></div>
</div>
</div>
<div class="section" id="using-aws-credentials">
<span id="aws-key"></span><h3>Using AWS credentials</h3>
<p>You can provide AWS credentials for your Presto cluster as
a Kubernetes secret. The secret name can be configured
using the <code class="code docutils literal"><span class="pre">hive.awsSecretName</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">awsSecretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">aws-secret-name</span>
</pre></div>
</div>
<p>Such secret should contain two files:</p>
<blockquote>
<div><ul class="simple">
<li>AWS_ACCESS_KEY_ID</li>
<li>AWS_SECRET_ACCESS_KEY</li>
</ul>
</div></blockquote>
<p>which contain corresponding AWS credentials.</p>
</div>
<div class="section" id="using-azure-storage-account-key-to-access-azure-blob">
<h3>Using Azure Storage account key to access Azure Blob</h3>
<p>You can provide an Azure Blob Storage account key for your Presto
cluster as a Kubernetes secret. The secret name can be configured
using the <code class="code docutils literal"><span class="pre">hive.azureWasbSecretName</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">azureWasbSecretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">azure-wasb-name</span>
</pre></div>
</div>
<p>Such a secret should contain two files</p>
<blockquote>
<div><ul class="simple">
<li>AZURE_WASB_STORAGE_ACCOUNT</li>
<li>AZURE_WASB_ACCESS_KEY</li>
</ul>
</div></blockquote>
<p>which contain the Azure Storage account name and key.</p>
</div>
<div class="section" id="using-azure-storage-account-key-to-access-adls-gen-2">
<h3>Using Azure Storage account key to access ADLS Gen 2</h3>
<p>You can provide an Azure ADLS Gen 2 Storage account key for your Presto
cluster as a Kubernetes secret. The secret name can be configured
using the <code class="code docutils literal"><span class="pre">hive.azureAbfsSecretName</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">azureAbfsSecretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">azure-secret-namme</span>
</pre></div>
</div>
<p>Such a secret should contain two files</p>
<blockquote>
<div><ul class="simple">
<li>AZURE_ABFS_STORAGE_ACCOUNT</li>
<li>AZURE_ABFS_ACCESS_KEY</li>
</ul>
</div></blockquote>
<p>which contain the Azure Storage account name and key.</p>
</div>
<div class="section" id="using-azure-credentials-to-access-adls-gen-1">
<h3>Using Azure credentials to access ADLS Gen 1</h3>
<p>You can provide Azure credentials for ADLS Gen 1
as a Kubernetes secret. The secret name can be configured
using the <code class="code docutils literal"><span class="pre">hive.azureAdlSecretName</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">azureAdlSecretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">azure-secret-namme</span>
</pre></div>
</div>
<p>Such a secret should contain three files</p>
<blockquote>
<div><ul class="simple">
<li>AZURE_ADL_CLIENT_ID</li>
<li>AZURE_ADL_CREDENTIAL</li>
<li>AZURE_ADL_REFRESH_URL</li>
</ul>
</div></blockquote>
<p>See <a class="reference external" href="https://docs.microsoft.com/en-us/azure/data-lake-store/data-lake-store-service-to-service-authenticate-using-active-directory">Service-to-service authentication with Azure Data Lake Storage Gen1 using Azure Active Directory</a>
for more information.</p>
</div>
<div class="section" id="using-google-service-account-key">
<span id="google-key"></span><h3>Using Google Service Account key</h3>
<p>You can provide a Google Service Account Key for the Presto Cluster
as a Kubernetes secret. The secret name can be configured
using the <code class="code docutils literal"><span class="pre">hive.googleServiceAccountKeySecretName</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">googleServiceAccountKeySecretName</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">google-service-account-key-secret-name</span>
</pre></div>
</div>
<p>Such secret should contain single file:</p>
<blockquote>
<div><ul class="simple">
<li>key.json</li>
</ul>
</div></blockquote>
<p>which contains Google Service Account Key in JSON format.</p>
</div>
<div class="section" id="specifying-additional-hive-connector-properties">
<h3>Specifying additional Hive connector properties</h3>
<p>It is possible to specify additional Hive connector properties
via the <code class="code docutils literal"><span class="pre">hive.additionalProperties</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">additionalProperties</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">|</span>
    <span class="no">hive.allow-drop-table=true</span>
</pre></div>
</div>
</div>
<div class="section" id="customizing-internal-hive-metastore-pod">
<h3>Customizing internal Hive Metastore pod</h3>
<p>It possible to customize internal Hive Metastore pod’s Docker
image via the <code class="code docutils literal"><span class="pre">hive.internalMetastore.image</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">customized-internal-hive-metastore</span>
      <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
      <span class="l l-Scalar l-Scalar-Plain">pullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</pre></div>
</div>
<p>It is possible to change the resources required by Hive Metastore’s pod
via:</p>
<blockquote>
<div><ul class="simple">
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.cpu</span></code></li>
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.memory</span></code></li>
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.nodeSelector</span></code></li>
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.affinity</span></code></li>
</ul>
</div></blockquote>
<p>properties.</p>
</div>
<div class="section" id="customizing-internal-postgresql-docker-pod">
<span id="internal-postgresql"></span><h3>Customizing internal PostgreSQL Docker pod</h3>
<p>It is possible to customize the internal PostgreSQL pod’s Docker
image via the <code class="code docutils literal"><span class="pre">hive.internalMetastore.internalPostgreSql.image</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">internalPostgreSql</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">name</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">customized-internal-postgresql</span>
        <span class="l l-Scalar l-Scalar-Plain">tag</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">0.1</span>
        <span class="l l-Scalar l-Scalar-Plain">pullPolicy</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span>
</pre></div>
</div>
<p>It is possible to change the resources required by PostgreSQL’s pod
via:</p>
<blockquote>
<div><ul class="simple">
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.internalPostgreSql.cpu</span></code></li>
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.internalPostgreSql.memory</span></code></li>
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.internalPostgreSql.nodeSelector</span></code></li>
<li><code class="code docutils literal"><span class="pre">hive.internalMetastore.internalPostgreSql.affinity</span></code></li>
</ul>
</div></blockquote>
<p>properties.</p>
<p>It is possible to specify the storage used by PostgreSQL’s pod via:
the <code class="code docutils literal"><span class="pre">hive.internalMetastore.internalPostgreSql.storage</span></code> property, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">hive</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">internalMetastore</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">internalPostgreSql</span><span class="p p-Indicator">:</span>
      <span class="l l-Scalar l-Scalar-Plain">storage</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">className</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">db-class</span>
        <span class="l l-Scalar l-Scalar-Plain">size</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">20Gi</span>
        <span class="l l-Scalar l-Scalar-Plain">claimSelector</span><span class="p p-Indicator">:</span>
          <span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
            <span class="l l-Scalar l-Scalar-Plain">release</span><span class="p p-Indicator">:</span> <span class="s">&quot;stable&quot;</span>
          <span class="l l-Scalar l-Scalar-Plain">matchExpressions</span><span class="p p-Indicator">:</span>
            <span class="p p-Indicator">-</span> <span class="p p-Indicator">{</span><span class="nv">key</span><span class="p p-Indicator">:</span> <span class="nv">environment</span><span class="p p-Indicator">,</span> <span class="nv">operator</span><span class="p p-Indicator">:</span> <span class="nv">In</span><span class="p p-Indicator">,</span> <span class="nv">values</span><span class="p p-Indicator">:</span> <span class="p p-Indicator">[</span><span class="nv">dev</span><span class="p p-Indicator">]}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="prometheus-support">
<h2>Prometheus support</h2>
<p>Presto Kubernetes supports exposing Presto metrics to Prometheus.
You can use the <a class="reference external" href="https://github.com/coreos/prometheus-operator">Prometheus Operator</a>
in order to set up Prometheus in your Kubernetes cluster and collect Presto metrics.</p>
<p>To enable Presto Prometheus metric endpoints set the <code class="code docutils literal"><span class="pre">prometheus.enabled</span></code> property
to <code class="code docutils literal"><span class="pre">true</span></code>. This will cause the following additional Kubernetes services to be
created:</p>
<ul class="simple">
<li><code class="code docutils literal"><span class="pre">prometheus-coordinator-CLUSTER_NAME_UUID</span></code></li>
<li><code class="code docutils literal"><span class="pre">prometheus-worker-CLUSTER_NAME_UUID</span></code></li>
</ul>
<p>where <code class="code docutils literal"><span class="pre">CLUSTER_NAME_UUID</span></code> is the cluster name with a unique suffix.
Use the <code class="code docutils literal"><span class="pre">nameOverride</span></code> property in order to set <code class="code docutils literal"><span class="pre">CLUSTER_NAME_UUID</span></code>
to a different value.</p>
<p>Those services will expose Presto metrics in the Prometheus format. You can use
<a class="reference external" href="https://github.com/coreos/prometheus-operator#customresourcedefinitions">ServiceMonitor</a>
resources from the Prometheus Operator to make Prometheus collect metrics from those endpoints.
In order to match Presto Prometheus endpoints you can use <a class="reference internal" href="overview.html#id1"><span class="std std-ref">labels</span></a>, e.g.</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">matchLabels</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">instance</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">CLUSTER_NAME_UUID</span>
  <span class="l l-Scalar l-Scalar-Plain">role</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">prometheus-coordinator</span>
</pre></div>
</div>
<p>The following Presto and JVM metrics will be exported by default:</p>
<ul class="simple">
<li><code class="code docutils literal"><span class="pre">running_queries</span></code> - number of currently running queries</li>
<li><code class="code docutils literal"><span class="pre">queued_queries</span></code> - number of currently queued queries</li>
<li><code class="code docutils literal"><span class="pre">failed_queries</span></code> - total count of failed queries</li>
<li><code class="code docutils literal"><span class="pre">jvm_gc_collection_seconds_sum</span></code> – total GC (young and old) time in seconds</li>
<li><code class="code docutils literal"><span class="pre">jvm_gc_collection_seconds_count</span></code> – total GC (young and old) count</li>
<li><code class="code docutils literal"><span class="pre">jvm_memory_bytes_committed,</span> <span class="pre">jvm_memory_bytes_init,</span> <span class="pre">jvm_memory_bytes_max,</span> <span class="pre">jvm_memory_bytes_used</span></code> –
JVM memory usage metrics (heap and non-heap). For more information see <a class="reference external" href="https://docs.oracle.com/javase/8/docs/api/java/lang/management/MemoryMXBean.html">MemoryMXBean</a>.</li>
</ul>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="query.html" class="btn btn-neutral float-right" title="7.6. Querying Presto" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="prerequisites.html" class="btn btn-neutral" title="7.4. Prerequisites" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'323-e.6',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>