

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>5.9. Horizontal Scaling of a Presto K8s Cluster &mdash; Starburst Enterprise Presto</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Enterprise Presto" href="../index.html"/>
        <link rel="up" title="5. Presto on Kubernetes" href="../kubernetes.html"/>
        <link rel="next" title="5.10. Kubernetes Resources Release Notes" href="release_notes.html"/>
        <link rel="prev" title="5.8. Customizing The Presto Docker Images" href="customizing_presto_image.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Enterprise Presto
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mission-control.html">3. Mission Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">4. Presto on Amazon Web Services</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../kubernetes.html">5. Presto on Kubernetes</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">5.1. Getting Started: A Quick Guide to Presto on Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="online_deploy.html">5.2. Deploy Presto on Kubernetes from DockerHub</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">5.3. Overview of Presto on Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">5.4. Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="presto_resource.html">5.5. Presto Kubernetes Resource</a></li>
<li class="toctree-l2"><a class="reference internal" href="query.html">5.6. Querying Presto</a></li>
<li class="toctree-l2"><a class="reference internal" href="gke.html">5.7. Presto on Google Kubernetes Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="customizing_presto_image.html">5.8. Customizing The Presto Docker Images</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">5.9. Horizontal Scaling of a Presto K8s Cluster</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#horizontal-pod-scaling">Horizontal pod scaling</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cluster-scaling">Cluster scaling</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#google-kubernetes-engine">Google Kubernetes Engine</a></li>
<li class="toctree-l4"><a class="reference internal" href="#on-prem-kubernetes-cluster">On-prem Kubernetes cluster</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="release_notes.html">5.10. Kubernetes Resources Release Notes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">6. Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">7. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">8. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">9. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">10. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">11. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">12. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">13. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">14. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">15. Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">16. Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../404.html">404 - Nothing to See Here</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">
          <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px;"
          src="../_static/img/logo/starburst-darkbg.png"/></a>
        <a href="../index.html">Starburst Enterprise Presto</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../kubernetes.html">5. Presto on Kubernetes</a> &raquo;</li>
      
    <li>5.9. Horizontal Scaling of a Presto K8s Cluster</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="horizontal-scaling-of-a-presto-k8s-cluster">
<h1>5.9. Horizontal Scaling of a Presto K8s Cluster<a class="headerlink" href="#horizontal-scaling-of-a-presto-k8s-cluster" title="Permalink to this headline">#</a></h1>
<p>Kubernetes allows scaling Presto using <a class="reference external" href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/">Horizontal Pod Autoscaler</a>.</p>
<div class="section" id="horizontal-pod-scaling">
<h2>Horizontal pod scaling<a class="headerlink" href="#horizontal-pod-scaling" title="Permalink to this headline">#</a></h2>
<p>HPA continously monitors Presto worker metrics and creates/terminates worker pods as needed
to ensure there are enough worker pods to handle incoming queries.</p>
<p>HPA can be enabled in the <code class="docutils literal"><span class="pre">worker</span></code> section of the Presto operator configuration file:</p>
<div class="highlight-yaml"><div class="highlight"><pre><span></span><span class="l l-Scalar l-Scalar-Plain">worker</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">count</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">2</span>
  <span class="l l-Scalar l-Scalar-Plain">autoscaling</span><span class="p p-Indicator">:</span>
    <span class="l l-Scalar l-Scalar-Plain">enabled</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
    <span class="l l-Scalar l-Scalar-Plain">minReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">1</span>
    <span class="l l-Scalar l-Scalar-Plain">maxReplicas</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">100</span>
    <span class="l l-Scalar l-Scalar-Plain">targetCPUUtilizationPercentage</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">80</span>
  <span class="l l-Scalar l-Scalar-Plain">cpuLimit</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
  <span class="l l-Scalar l-Scalar-Plain">cpuRequest</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">15</span>
</pre></div>
</div>
<p>This configuration allows controlling the number of pods, as well as sets the target CPU usage the HPA will try to achieve.</p>
<p>Note that for HPA to work, worker CPU limit must also be set, otherwise Kubernetes won’t monitor CPU usage and HPA won’t have any useful metrics to work on.
Please set the CPU limit and CPU request to the same value when using HPA, preferably to <code class="docutils literal"><span class="pre">number</span> <span class="pre">of</span> <span class="pre">node</span> <span class="pre">cores</span> <span class="pre">-</span> <span class="pre">1</span></code> for dedicated Presto nodes.
Setting both of these to the same value is important because CPU utilization percentage is calculated as <code class="docutils literal"><span class="pre">cpuUsage/cpuRequest</span></code>, but is limited by <code class="docutils literal"><span class="pre">cpuLimit</span></code>.
If <code class="docutils literal"><span class="pre">cpuRequest</span></code> is smaller than <code class="docutils literal"><span class="pre">cpuLimit</span></code>, CPU utilization can be greater than 100%, and this can lead to huge spikes in the number of pods.</p>
</div>
<div class="section" id="cluster-scaling">
<h2>Cluster scaling<a class="headerlink" href="#cluster-scaling" title="Permalink to this headline">#</a></h2>
<p>HPA schedules new pods to be started, but the pods still need nodes to run on.
They can be provisioned on demand or taken from a large global pool.</p>
<div class="section" id="google-kubernetes-engine">
<h3>Google Kubernetes Engine<a class="headerlink" href="#google-kubernetes-engine" title="Permalink to this headline">#</a></h3>
<p>On GKE it’s possible for a Kubernetes cluster to autoscale the number of nodes according to the resources required by pods (see <a class="reference external" href="https://cloud.google.com/kubernetes-engine/docs/concepts/cluster-autoscaler?hl=en_US">Cluster autoscaler</a>).
Combined with HPA these two mechanisms allow you to minimize the cost of running an efficient Presto cluster.</p>
</div>
<div class="section" id="on-prem-kubernetes-cluster">
<h3>On-prem Kubernetes cluster<a class="headerlink" href="#on-prem-kubernetes-cluster" title="Permalink to this headline">#</a></h3>
<p>An on-prem cluster typically pools all machines available, with resources shared between different services in separate namespaces.
While the total number of nodes is constant in this scenario, the amount of resources dedicated to Presto still matches the demand thanks to pod creation/termination by the HPA.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="release_notes.html" style="box-shadow: none; border: none;" class="btn btn-neutral float-right" title="5.10. Kubernetes Resources Release Notes" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="customizing_presto_image.html" style="box-shadow: none; border: none;" class="btn btn-neutral" title="5.8. Customizing The Presto Docker Images" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'332-e.0-SNAPSHOT',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>