

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>6.5. User Mapping &mdash; Starburst Enterprise Presto</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Enterprise Presto" href="../index.html"/>
        <link rel="up" title="6. Security" href="../security.html"/>
        <link rel="next" title="6.6. Java Keystores and Truststores" href="tls.html"/>
        <link rel="prev" title="6.4. Password File Authentication" href="password-file.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Enterprise Presto
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mission-control.html">3. Mission Control</a></li>
<li class="toctree-l1"><a class="reference internal" href="../aws.html">4. Amazon Web Services</a></li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes.html">5. Kubernetes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../security.html">6. Security</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="server.html">6.1. Coordinator Kerberos Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="cli.html">6.2. CLI Kerberos Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldap.html">6.3. LDAP Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="password-file.html">6.4. Password File Authentication</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">6.5. User Mapping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#pattern-mapping-rule">Pattern Mapping Rule</a></li>
<li class="toctree-l3"><a class="reference internal" href="#file-mapping-rules">File Mapping Rules</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tls.html">6.6. Java Keystores and Truststores</a></li>
<li class="toctree-l2"><a class="reference internal" href="built-in-system-access-control.html">6.7. Built-in System Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="ldap-group-provider.html">6.8. LDAP group provider</a></li>
<li class="toctree-l2"><a class="reference internal" href="secrets.html">6.9. Secrets</a></li>
<li class="toctree-l2"><a class="reference internal" href="internal-communication.html">6.10. Secure Internal Communication</a></li>
<li class="toctree-l2"><a class="reference internal" href="audit.html">6.11. Query Audit</a></li>
<li class="toctree-l2"><a class="reference internal" href="event-logger.html">6.12. Event Logger</a></li>
<li class="toctree-l2"><a class="reference internal" href="rbac.html">6.13. Role Based Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="system-ranger.html">6.14. System Level Security with Apache Ranger</a></li>
<li class="toctree-l2"><a class="reference internal" href="hive-ranger.html">6.15. Hive Level Security with Apache Ranger</a></li>
<li class="toctree-l2"><a class="reference internal" href="hive-sentry.html">6.16. Hive Level Security with Apache Sentry</a></li>
<li class="toctree-l2"><a class="reference internal" href="impersonation.html">6.17. User Impersonation</a></li>
<li class="toctree-l2"><a class="reference internal" href="credential-passthrough.html">6.18. Kerberos Credential Passthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="okta-authentication.html">6.19. Okta Authentication</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">7. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">8. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">9. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">10. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">11. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">12. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">13. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">14. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">15. Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">16. Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../404.html">404 - Nothing to See Here</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://www.starburstdata.com/">
          <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px;"
          src="../_static/img/starburst-darkbg.png"/></a>
        <span class="optional">
          <a href="../index.html">Starburst Enterprise Presto</a>
          <a href="../versions.html" style="font-size: small;margin-left: 0.5em;">332-e.2 LTS and others</a>
          <a href="https://www.starburstdata.com/oreilly-presto-guide-download/?utm_campaign=O%27Reilly%20Presto%20Book&utm_source=starburst&utm_medium=docs">
            <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px; margin-left: 0.5em;"
          src="../_static/img/ptdg-banner.png"/></a>
          </span>
          <span class="optional">
  <select name="versions" id="versions" onChange="window.location.href=this.value">
    <option value="./" >Choose another version</option>
    <option value="/latest-lts/">Latest LTS</option>
    <!-- <option value="/latest-sts/">Latest STS</option> -->
    <option value="/332-e/">332-e LTS</option>
    <!-- <option value="/334-e">334-e STS</option> -->
    <option value="/323-e/">323-e LTS</option>
    <option value="/312-e/">312-e LTS</option>
  </select>
</span>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../security.html">6. Security</a> &raquo;</li>
      
    <li>6.5. User Mapping</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-mapping">
<h1>6.5. User Mapping<a class="headerlink" href="#user-mapping" title="Permalink to this headline">#</a></h1>
<p>User mapping defines rules for mapping from users in the authentication system to Presto users.  This
mapping is particularly important for Kerberos or certificate authentication where the user names
are complex like <code class="docutils literal"><span class="pre">alice&#64;example</span></code> or <code class="docutils literal"><span class="pre">CN=Alice</span> <span class="pre">Smith,</span> <span class="pre">OU=Finance,</span> <span class="pre">O=Acme,</span> <span class="pre">C=US</span></code>.</p>
<p>User mapping can be configured with a simple regex extraction pattern, or more complex rules in a
separate configuration file.</p>
<div class="section" id="pattern-mapping-rule">
<h2>Pattern Mapping Rule<a class="headerlink" href="#pattern-mapping-rule" title="Permalink to this headline">#</a></h2>
<p>The pattern mapping rule maps the authentication user to the first matching group in the regular
expression.  If the regular expression does not match the authentication user, authentication is
denied.</p>
<p>Each authentication system has a separate property for the user mapping pattern to allow different mapping
when multiple authentication systems are enabled:</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Authentication</th>
<th class="head">Property</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Username and Password (file or LDAP)</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.password.user-mapping.pattern</span></code></td>
</tr>
<tr class="row-odd"><td>Kerberos</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.krb5.user-mapping.pattern</span></code></td>
</tr>
<tr class="row-even"><td>Certificate</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.certificate.user-mapping.pattern</span></code></td>
</tr>
<tr class="row-odd"><td>Json Web Token</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.jwt.user-mapping.pattern</span></code></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="file-mapping-rules">
<h2>File Mapping Rules<a class="headerlink" href="#file-mapping-rules" title="Permalink to this headline">#</a></h2>
<p>The file mapping rules allow for more complex mappings from the authentication user.  These rules are
loaded from a JSON file defined in a configuration property.  The mapping is based on the first matching
rule, processed from top to bottom. If no rules match, authentication is denied.  Each rule is composed of the
following fields:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">pattern</span></code> (required): regex to match against authentication user.</li>
<li><code class="docutils literal"><span class="pre">user</span></code> (optional): replacement string to substitute against pattern.
The default value is <code class="docutils literal"><span class="pre">$1</span></code>.</li>
<li><code class="docutils literal"><span class="pre">allow</span></code> (optional): boolean indicating if the authentication should be allowed.</li>
</ul>
<p>The following example maps all users like <code class="docutils literal"><span class="pre">alice&#64;example.com</span></code> to just <code class="docutils literal"><span class="pre">alice</span></code>, except for the <code class="docutils literal"><span class="pre">test</span></code>
user which is denied authentication, and it maps users like <code class="docutils literal"><span class="pre">bob&#64;uk.example.com</span></code> to <code class="docutils literal"><span class="pre">bob_uk</span></code>:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;rules&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="nt">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;test@example\\.com&quot;</span><span class="p">,</span>
            <span class="nt">&quot;allow&quot;</span><span class="p">:</span> <span class="kc">false</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;(.+)@example\\.com&quot;</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="nt">&quot;pattern&quot;</span><span class="p">:</span> <span class="s2">&quot;(?&lt;user&gt;.+)@(?&lt;region&gt;.+)\\.example\\.com&quot;</span><span class="p">,</span>
            <span class="nt">&quot;user&quot;</span><span class="p">:</span> <span class="s2">&quot;${user}_${region}&quot;</span>
        <span class="p">}</span>
    <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Each authentication system has a separate property for the user mapping file to allow different mapping
when multiple authentication systems are enabled:</p>
<table border="1" class="docutils">
<colgroup>
<col width="37%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Authentication</th>
<th class="head">Property</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Username and password (file or LDAP)</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.password.user-mapping.file</span></code></td>
</tr>
<tr class="row-odd"><td>Kerberos</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.krb5.user-mapping.file</span></code></td>
</tr>
<tr class="row-even"><td>Certificate</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.certificate.user-mapping.file</span></code></td>
</tr>
<tr class="row-odd"><td>Json Web Token</td>
<td><code class="docutils literal"><span class="pre">http-server.authentication.jwt.user-mapping.file</span></code></td>
</tr>
</tbody>
</table>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tls.html" style="box-shadow: none; border: none;" class="btn btn-neutral float-right" title="6.6. Java Keystores and Truststores" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="password-file.html" style="box-shadow: none; border: none;" class="btn btn-neutral" title="6.4. Password File Authentication" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>

  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'332',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>