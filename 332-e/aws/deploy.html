

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>4.4. Deploying Presto &mdash; Starburst Enterprise Presto</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/starburst.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="Starburst Enterprise Presto" href="../index.html"/>
        <link rel="up" title="4. Amazon Web Services" href="../aws.html"/>
        <link rel="next" title="4.5. Configuring Presto" href="configuration.html"/>
        <link rel="prev" title="4.3. Prerequisites" href="prerequisites.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Starburst Enterprise Presto
          

          
          </a>

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview.html">1. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">2. Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mission-control.html">3. Mission Control</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../aws.html">4. Amazon Web Services</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="quickstart.html">4.1. Getting Started on AWS</a></li>
<li class="toctree-l2"><a class="reference internal" href="overview.html">4.2. Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="prerequisites.html">4.3. Prerequisites</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">4.4. Deploying Presto</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#deploying-the-presto-ami-using-aws-ec2-console">Deploying the Presto AMI Using AWS EC2 Console</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploying-a-presto-cluster-using-cloudformation-template-web-console">Deploying a Presto Cluster Using CloudFormation Template (Web Console)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deploying-a-presto-cluster-using-cloudformation-template-aws-cli">Deploying a Presto Cluster Using CloudFormation Template (AWS CLI)</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#permissions-required-for-deployment">Permissions Required for Deployment</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">4.5. Configuring Presto</a></li>
<li class="toctree-l2"><a class="reference internal" href="metastore.html">4.6. Configuring Hive Metastore</a></li>
<li class="toctree-l2"><a class="reference internal" href="access.html">4.7. Accessing the Presto Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="query.html">4.8. Querying Presto</a></li>
<li class="toctree-l2"><a class="reference internal" href="s3.html">4.9. Querying AWS S3</a></li>
<li class="toctree-l2"><a class="reference internal" href="glue.html">4.10. AWS Glue Support</a></li>
<li class="toctree-l2"><a class="reference internal" href="superset.html">4.11. Using Apache Superset</a></li>
<li class="toctree-l2"><a class="reference internal" href="manualscale.html">4.12. Manual Scaling a Running Presto Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="autoscale.html">4.13. Auto Scaling a Presto Cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="high-availability.html">4.14. Presto Coordinator High Availability</a></li>
<li class="toctree-l2"><a class="reference internal" href="logs.html">4.15. Integration with CloudWatch Logs</a></li>
<li class="toctree-l2"><a class="reference internal" href="metrics.html">4.16. Integration with CloudWatch Metrics</a></li>
<li class="toctree-l2"><a class="reference internal" href="troubleshooting.html">4.17. Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference internal" href="uninstall.html">4.18. Uninstalling Presto</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../kubernetes.html">5. Kubernetes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../security.html">6. Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin.html">7. Administration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimizer.html">8. Query Optimizer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connector.html">9. Connectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../functions.html">10. Functions and Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../language.html">11. SQL Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../sql.html">12. SQL Statement Syntax</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration.html">13. Migration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../develop.html">14. Developer Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../versions.html">15. Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../release.html">16. Release Notes</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../404.html">404 - Nothing to See Here</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://www.starburstdata.com/">
          <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px;"
          src="../_static/img/starburst-darkbg.png"/></a>
        <span class="optional">
          <a href="../index.html">Starburst Enterprise Presto</a>
          <a href="../versions.html" style="font-size: small;margin-left: 0.5em;">332-e.1 and others</a>
          <a href="https://www.starburstdata.com/oreilly-presto-guide-download/?utm_campaign=O%27Reilly%20Presto%20Book&utm_source=starburst&utm_medium=docs">
            <img class="logo"style="background-color: transparent; border-radius: 0%; width: auto; height: auto ;padding: 0px; margin-left: 0.5em;"
          src="../_static/img/ptdg-banner.png"/></a>
          </span>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
        <li><a href="../aws.html">4. Amazon Web Services</a> &raquo;</li>
      
    <li>4.4. Deploying Presto</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="deploying-presto">
<h1>4.4. Deploying Presto<a class="headerlink" href="#deploying-presto" title="Permalink to this headline">#</a></h1>
<p><a class="reference external" href="https://aws.amazon.com/marketplace/pp/B07DKV5659/ref=_ptnr_starburst_docs">Presto on AWS Marketplace</a> is
available as both an Amazon Machine Image (AMI) and a CloudFormation template.
Launching as an AMI provides a fully functional single node Presto setup –
suitable for trial deployment of Presto in your development environment. The
Starburst CloudFormation template is ideal for production deployment by
configuring multiple Presto AMIs to form a Presto cluster.</p>
<div class="contents local topic" id="presto-deployment-options">
<p class="topic-title first">Presto Deployment Options</p>
<ul class="simple">
<li><a class="reference internal" href="#deploying-the-presto-ami-using-aws-ec2-console" id="id2">Deploying the Presto AMI Using AWS EC2 Console</a></li>
<li><a class="reference internal" href="#deploying-a-presto-cluster-using-cloudformation-template-web-console" id="id3">Deploying a Presto Cluster Using CloudFormation Template (Web Console)</a></li>
<li><a class="reference internal" href="#deploying-a-presto-cluster-using-cloudformation-template-aws-cli" id="id4">Deploying a Presto Cluster Using CloudFormation Template (AWS CLI)</a></li>
<li><a class="reference internal" href="#permissions-required-for-deployment" id="id5">Permissions Required for Deployment</a></li>
</ul>
</div>
<div class="section" id="deploying-the-presto-ami-using-aws-ec2-console">
<h2><a class="toc-backref" href="#id2">Deploying the Presto AMI Using AWS EC2 Console</a><a class="headerlink" href="#deploying-the-presto-ami-using-aws-ec2-console" title="Permalink to this headline">#</a></h2>
<p><strong>1. Launching the AMI</strong></p>
<blockquote>
<div><p>After subscribing to the software, choose ‘Launch through EC2’ to launch
through the AWS EC2 Console.</p>
<a class="reference internal image-reference" href="../_images/presto_ami_launch.png"><img alt="../_images/presto_ami_launch.png" src="../_images/presto_ami_launch.png" style="width: 1690.0px; height: 1172.0px;" /></a>
<p>This directs you to the ‘Choose an Instance Type’ step. Optionally you can
choose ‘Copy to Service Catalog’ for when using with the <a class="reference external" href="https://aws.amazon.com/servicecatalog/">AWS Service Catalog</a>.</p>
</div></blockquote>
<p><strong>2. Choose an Instance Type</strong></p>
<blockquote>
<div>Choose an instance type that best suits your workload. The <code class="docutils literal"><span class="pre">r4.4xlarge</span></code>
instance type is recommended by default and works well for most workloads. See
<a class="reference internal" href="overview.html#aws-recommended-types"><span class="std std-ref">Recommended Instance Types</span></a> to assist you with what instance types may be
best for you. Note that a single node Presto instance is typically used for
trying Presto in a development environment.</div></blockquote>
<p><strong>3. Configure Instance Details</strong></p>
<blockquote>
<div><p>Configure your instance to fit your needs. Choose the existing <strong>VPC</strong> and
<strong>Subnet</strong> you want to deploy to. And optionally choose an <strong>IAM Role</strong>.
Please refer to the <a class="reference internal" href="prerequisites.html"><span class="doc">Prerequisites</span></a> for more information on these various
specification fields.</p>
<a class="reference internal image-reference" href="../_images/presto_ami_configure.png"><img alt="../_images/presto_ami_configure.png" src="../_images/presto_ami_configure.png" style="width: 1902.0px; height: 877.0px;" /></a>
</div></blockquote>
<p><strong>4. Add Storage</strong></p>
<blockquote>
<div>Manage your instance’s storage and add supplementary EBS and instance store
volumes as needed. The defaults are generally OK.</div></blockquote>
<p><strong>5. Add Tags</strong></p>
<blockquote>
<div>Add and create <a class="reference external" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Using_Tags.html">one or more tags</a>.</div></blockquote>
<p><strong>6. Configure Security Group</strong></p>
<blockquote>
<div><p>Create or select an existing security group to control traffic to your
instance. Note that you are able to choose multiple security group IDs when
selecting from the pool of existing security groups. For additional
information regarding security groups, please refer to the
<a class="reference internal" href="prerequisites.html"><span class="doc">Prerequisites</span></a> section.</p>
<p>It is recommended that ports 8080 and 8088 are accessible in order to access
the Presto Web UI, submit queries from outside the cluster, and access Apache
Superset. Additionally, it’s recommended that port 22 is accessible for SSH
access.</p>
</div></blockquote>
<p><strong>7.  Review</strong></p>
<blockquote>
<div>Review the details of your instance. When content, proceed by pressing launch
to assign a key pair to the instance and conclude the launch process.</div></blockquote>
</div>
<div class="section" id="deploying-a-presto-cluster-using-cloudformation-template-web-console">
<h2><a class="toc-backref" href="#id3">Deploying a Presto Cluster Using CloudFormation Template (Web Console)</a><a class="headerlink" href="#deploying-a-presto-cluster-using-cloudformation-template-web-console" title="Permalink to this headline">#</a></h2>
<p><strong>1.  Select Template</strong></p>
<blockquote>
<div><p>After you subscribe to the Presto offering on AWS Marketplace, you are able
to launch CloudFormation.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_launch.png"><img alt="../_images/presto_cft_launch.png" src="../_images/presto_cft_launch.png" style="width: 1674.0px; height: 878.0px;" /></a>
<p>This directs you to the ‘Select Template’ step for creating a CloudFormation
stack. You should find a pre-populated field under ‘Amazon S3 template URL’.
This is the location of Starburst’s Presto CloudFormation template. Click
‘next’.</p>
<p>Optionally you can choose ‘Copy to Service Catalog’ for when using with the
<a class="reference external" href="https://aws.amazon.com/servicecatalog/">AWS Service Catalog</a>.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_select.png"><img alt="../_images/presto_cft_select.png" src="../_images/presto_cft_select.png" style="width: 2080.0px; height: 1390.0px;" /></a>
</div></blockquote>
<p><strong>2.  Specify Details</strong></p>
<blockquote>
<div><p>Proceed by specifying the details of your Presto cluster (CloudFormation
stack). This step includes network, EC2 and Presto configuration.</p>
<ul>
<li><p class="first"><strong>Preliminary Details:</strong>
Name your Presto cluster .</p>
<a class="reference internal image-reference" href="../_images/presto_cft_stackname.png"><img alt="../_images/presto_cft_stackname.png" src="../_images/presto_cft_stackname.png" style="width: 2054.0px; height: 394.0px;" /></a>
</li>
<li><p class="first"><strong>Network Configuration:</strong>
Specify your existing <strong>VPC</strong>, <strong>Subnet</strong>, and <strong>Security Groups</strong>. It is
assumed these are preconfigured in your AWS account. See the below
Prerequisites sections for more detail:</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="prerequisites.html#aws-vpc"><span class="std std-ref">VPC and VPC Subnets</span></a></li>
<li><a class="reference internal" href="prerequisites.html#aws-security-groups"><span class="std std-ref">Security Groups</span></a></li>
</ul>
</div></blockquote>
<p>Select <code class="docutils literal"><span class="pre">no</span></code> for <strong>SelectedSubnetAutoAssignsPublicIp</strong> if the selected
subnet does not provide public IPs. In this case VPC endpoints are created
for the Presto stack.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_network.png"><img alt="../_images/presto_cft_network.png" src="../_images/presto_cft_network.png" style="width: 1974.0px; height: 802.0px;" /></a>
</li>
<li><p class="first"><strong>EC2 Configuration:</strong></p>
<p>Choose a <strong>CoordinatorInstanceType</strong> and <strong>WorkerInstanceType</strong> suitable for
your workload. The <code class="docutils literal"><span class="pre">r4.4xlarge</span></code> instance types are chosen by default and
work well for most workloads. See <a class="reference internal" href="overview.html#aws-recommended-types"><span class="std std-ref">Recommended Instance Types</span></a> to assist you
with what instance types may be best for you.</p>
<p>Choose a <strong>KeyName</strong> which is the name of an EC2 KeyPair to enable SSH
access to the instance. See <a class="reference internal" href="prerequisites.html#aws-ssh"><span class="std std-ref">SSH Keys</span></a> for more detail.</p>
<p>Specify the  <strong>WorkersCount</strong> to specify the number of worker nodes
for the cluster. Worker nodes are added to an AWS AutoScaling Group.
See <a class="reference internal" href="autoscale.html"><span class="doc">Auto Scaling a Presto Cluster</span></a> for more detail.</p>
<p>Specify the <strong>HACoordinatorsCount</strong> for coordinator high availability. This
number represents 1 active coordinator plus the number of optional
hot-standby coordinators. For example, if you specify 3, then there is 1
active coordinator and 2 standby coordinators, if the active one fails. See
<a class="reference internal" href="high-availability.html"><span class="doc">Presto Coordinator High Availability</span></a> for more detail.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_ec2.png"><img alt="../_images/presto_cft_ec2.png" src="../_images/presto_cft_ec2.png" style="width: 1966.0px; height: 944.0px;" /></a>
<p>If you are using <a class="reference internal" href="../connector/hive-cache.html"><span class="doc">Hive object caching</span></a>, you
need to ensure a volume is mounted and configured on each worker, with
<a class="reference internal" href="#cft-properties"><span class="std std-ref">the properties WorkerMountVolume, WorkerVolumeType, WorkerVolumeSize,
and WorkerVolumeIOPS</span></a>.</p>
</li>
<li><p class="first"><strong>Presto Configuration:</strong></p>
</li>
</ul>
<blockquote>
<div><p><strong>AllowExternalAccessOnHttp</strong> indicates whether you are allowing external
access on HTTP. Disabled by default, this is to disallow external access for
security purposes. When disabled, clients (CLI/JDBC/etc) can connect to
Presto only from machines in the AWS Subnet specified above. When enabled
and instances are assigned public IP, Presto endpoints are available over
HTTP without authorization (unless eg. LDAP is configured via “Custom
Configuration”).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It’s important to make sure your AWS infrastructure is set up in
such a way that Presto is not publicly accessible.</p>
</div>
<p><strong>AdditionalCoordinatorConfigurationURI</strong> and
<strong>AdditionalWorkersConfigurationURI</strong> are the locations of your custom
Presto configuration if you wish to override the default configurations.
Please see the section <a class="reference internal" href="configuration.html#custom-configuration"><span class="std std-ref">Custom Configuration</span></a> for more detail.</p>
<p id="aws-bootstrap-script"><strong>BootstrapScriptURI</strong> is the location of an optional bash script to run on
the coordinator and worker nodes after Presto is configured but before it is
launched. For example, your bash script could be used to create directories,
install additional software, deploy UDFs, or deploy other plugins. When the
script is executed, a string argument value of <code class="docutils literal"><span class="pre">coordinator</span></code> or <code class="docutils literal"><span class="pre">worker</span></code>
is passed in. You can check for this argument value in your script to
perform certain actions based on the node type.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_configuration.png"><img alt="../_images/presto_cft_configuration.png" src="../_images/presto_cft_configuration.png" style="width: 1962.0px; height: 820.0px;" /></a>
<p><strong>PrestoHttpPort</strong> configures the Presto HTTP port number. By default it  is
set to <code class="docutils literal"><span class="pre">8080</span></code>.</p>
</div></blockquote>
<ul class="simple">
<li><strong>Hive Connector Options:</strong></li>
</ul>
<blockquote>
<div><p>The Hive connector is used to access data in HDFS or S3. It requires a Hive
Metastore so Presto knows where data lives. These options determine the Hive
Metastore to use. There are several ways you configure Hive Metastore in
Hive connector. Refer to the dedicated documentation <a class="reference internal" href="metastore.html"><span class="doc">Configuring Hive Metastore</span></a>
to determine your configuration.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_metastore.png"><img alt="../_images/presto_cft_metastore.png" src="../_images/presto_cft_metastore.png" style="width: 1968.0px; height: 1128.0px;" /></a>
</div></blockquote>
<ul class="simple">
<li><strong>Advanced AWS S3 configuration:</strong></li>
</ul>
<blockquote>
<div><p>With <strong>S3Endpoint</strong>, <strong>S3AccessKey</strong> and <strong>S3SecretKey</strong> it is possible to:</p>
<blockquote>
<div><ul class="simple">
<li>configure custom access credentials for AWS S3, in this case set only
<strong>S3AccessKey</strong> and <strong>S3SecretKey</strong></li>
<li>configure custom AWS S3 endpoint, in this cases set only <strong>S3Endpoint</strong></li>
<li>access third-party S3-compatible storage system, in this case set all
three parameters</li>
</ul>
</div></blockquote>
<p>Notice that these parameters only affect the configuration of  provisioned
Hive catalogs. All of these properties are optional, when not given EC2
instance default values are used.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_s3_configuration.png"><img alt="../_images/presto_cft_s3_configuration.png" src="../_images/presto_cft_s3_configuration.png" style="width: 1968.0px; height: 584.0px;" /></a>
</div></blockquote>
<ul>
<li><p class="first"><strong>Monitoring:</strong></p>
<p>Indicate if you want to enable integration with CloudWatch metrics. When
enabled, OS and Presto metrics are reported for each cluster node.
Additionally, a CloudWatch Dashboard with cluster overview is created.
Additional CloudWatch fees are charged. Please refer to <a class="reference internal" href="metrics.html"><span class="doc">Integration with CloudWatch Metrics</span></a>
for more detail.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_monitoring.png"><img alt="../_images/presto_cft_monitoring.png" src="../_images/presto_cft_monitoring.png" style="width: 1958.0px; height: 260.0px;" /></a>
</li>
<li><p class="first"><strong>Advanced:</strong></p>
<p>Optionally specificy the <strong>InstanceProfile</strong> to attach to Presto nodes. See
<a class="reference internal" href="prerequisites.html#aws-instance-profiles"><span class="std std-ref">Instance Profiles</span></a> for more detail. If you do not specificy the
InstanceProfile, the CloudFormation Template creates the necessary IAM role
privleges.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_iam.png"><img alt="../_images/presto_cft_iam.png" src="../_images/presto_cft_iam.png" style="width: 1964.0px; height: 288.0px;" /></a>
</li>
<li><p class="first"><strong>Other:</strong></p>
<p>Indicate whether you are deploying and using Apache Superset.</p>
<a class="reference internal image-reference" href="../_images/presto_cft_superset.png"><img alt="../_images/presto_cft_superset.png" src="../_images/presto_cft_superset.png" style="width: 1962.0px; height: 262.0px;" /></a>
</li>
</ul>
</div></blockquote>
<dl class="docutils">
<dt><strong>3. Options</strong></dt>
<dd>Enter any additional stack specifications as shown on the Options page. These
options include adding tags to resources within your cluster, choosing IAM
roles, and specifying monitoring time for rollback triggers, among other
advanced specifications. More information can be found in the <a class="reference external" href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/Welcome.html">AWS
CloudFormation documentation</a>.</dd>
<dt><strong>4. Review</strong></dt>
<dd><p class="first">Finally, review the details of your Presto cluster. When content, proceed by
pressing create to conclude the creation.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Just above the final “Create stack” button there is a blueish box informing
you that <em>The following resource(s) require capabilities: [AWS::IAM::Role]</em>.
In order to create the Stack you need to mark the checkbox next to <em>I
acknowledge that AWS CloudFormation might create IAM resources.</em></p>
</div>
</dd>
</dl>
</div>
<div class="section" id="deploying-a-presto-cluster-using-cloudformation-template-aws-cli">
<h2><a class="toc-backref" href="#id4">Deploying a Presto Cluster Using CloudFormation Template (AWS CLI)</a><a class="headerlink" href="#deploying-a-presto-cluster-using-cloudformation-template-aws-cli" title="Permalink to this headline">#</a></h2>
<p>After subscribing to the software you can optionally deploy a Presto cluster
using the <a class="reference external" href="https://aws.amazon.com/cli/">AWS CLI</a> instead of the AWS Web
Console. Ensure the CLI is installed and configured before you proceed.</p>
<dl class="docutils">
<dt><strong>1. Open a Terminal Window</strong></dt>
<dd>Open a terminal window to begin a command line.</dd>
<dt><strong>2. Create Stack</strong></dt>
<dd>Use the create stack command to initiate the creation of your Presto cluster
(CloudFormation stack).</dd>
</dl>
<div class="highlight-none"><div class="highlight"><pre><span></span>create-stack
</pre></div>
</div>
<dl class="docutils">
<dt><strong>3. Name Stack</strong></dt>
<dd>Specify the name that is to be associated with the cluster. The name must be
unique in the region in which you are creating the cluster.</dd>
</dl>
<div class="highlight-none"><div class="highlight"><pre><span></span>--stack-name (string)
</pre></div>
</div>
<dl class="docutils">
<dt><strong>4. Specify Template</strong></dt>
<dd><p class="first">Indicate the template you are using to create your cluster.</p>
<p class="last">URL: Specify the location of the file containing the template body. The URL
must point to a template that is located in an Amazon S3 bucket.</p>
</dd>
</dl>
<div class="highlight-none"><div class="highlight"><pre><span></span>--template-url (string)
</pre></div>
</div>
<p><strong>5. Specify Parameters</strong></p>
<blockquote>
<div>Define a list of parameter structures that specify input parameters for the
cluster. Reference the following list of possible parameters for your cluster
creation.</div></blockquote>
<table border="1" class="colwidths-given docutils" id="cft-properties">
<caption><span class="caption-text">Configuration Parameters</span><a class="headerlink" href="#cft-properties" title="Permalink to this table">#</a></caption>
<colgroup>
<col width="15%" />
<col width="80%" />
<col width="5%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Parameter Key</th>
<th class="head">Description</th>
<th class="head">Example Parameter Values</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>VPC</td>
<td>Virtual Private Cloud ID</td>
<td>vpc-4bd6ca11</td>
</tr>
<tr class="row-odd"><td>Subnet</td>
<td>Subnet to use for Presto nodes (must belong to the selected VPC)</td>
<td>subnet-123abc2b</td>
</tr>
<tr class="row-even"><td>SelectedSubnetAutoAssignsPublicIp</td>
<td>Set to <code class="docutils literal"><span class="pre">no</span></code> if selected subnet does not provide public IPs. In this
case VPC endpoints are created for the Presto stack.</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>SecurityGroups</td>
<td>Additional Security Groups for Presto nodes (e.g: allowing SSH access).
Must select at least one.</td>
<td>sg-12e34aeb</td>
</tr>
<tr class="row-even"><td>CoordinatorInstanceType</td>
<td>EC2 instance type of the coordinator.</td>
<td>r4.xlarge</td>
</tr>
<tr class="row-odd"><td>WorkerInstanceType</td>
<td>EC2 instance type of the workers.</td>
<td>r4.xlarge</td>
</tr>
<tr class="row-even"><td>KeyName</td>
<td>Name of an EC2 KeyPair to enable SSH access to the instance.</td>
<td>john.smith</td>
</tr>
<tr class="row-odd"><td>IamInstanceProfile</td>
<td>The name of an instance profile to attach to Presto nodes (Optional)</td>
<td>my-ec2-instance-profile</td>
</tr>
<tr class="row-even"><td>WorkersCount</td>
<td>Number of dedicated worker nodes (apart from coordinator) to instantiate</td>
<td>10</td>
</tr>
<tr class="row-odd"><td>HACoordinatorsCount</td>
<td>Number of coordinator nodes to instantiate. If more then one, the
coordinator offers HA capabilities.</td>
<td>1</td>
</tr>
<tr class="row-even"><td>WorkerMountVolume</td>
<td>Mount an additional EBS volume on each worker at <code class="docutils literal"><span class="pre">/data</span></code>. This is
required when using <a class="reference internal" href="../connector/hive-cache.html"><span class="doc">Hive object caching</span></a>.
Ensure that the directory <code class="docutils literal"><span class="pre">/data</span></code> exists and is configured in your Hive
catalog properties. You can create the directory with a <a class="reference internal" href="#aws-bootstrap-script"><span class="std std-ref">bootstrap
script</span></a>. .</td>
<td>yes, defaults to no</td>
</tr>
<tr class="row-odd"><td>WorkerVolumeType</td>
<td>Type of the additional EBS volume mounted on the workers.</td>
<td>gp2 or io1 (default)</td>
</tr>
<tr class="row-even"><td>WorkerVolumeSize</td>
<td>Size of the additional EBS volume mounted on the workers, in GiB.
Use at least 10GiB with the io1 volume type.</td>
<td>4 (default), range from 4 to 16384 is valid</td>
</tr>
<tr class="row-odd"><td>WorkerVolumeIOPS</td>
<td>The number of possible I/O operations per second for the additional
volume. Used only with the io1 volume type. Each 5000 I/O ops require at
least 100 GiB storage size on the volume.</td>
<td>100 (default), range from 100 to 20000 is valid</td>
</tr>
<tr class="row-even"><td>KeepCoordinatorNode</td>
<td>(Debug only) Keep coordinator node running after the coordinator
service fails.</td>
<td>yes</td>
</tr>
<tr class="row-odd"><td>LaunchSuperset</td>
<td>When enabled, Superset is deployed and started on an EC2 instance</td>
<td>yes</td>
</tr>
<tr class="row-even"><td>AllowExternalAccessOnHttp</td>
<td>When enabled and instances are assigned public IP, Presto endpoints are
available over HTTP without authorization.</td>
<td>no</td>
</tr>
<tr class="row-odd"><td>MetastoreType</td>
<td>Determines what metastore is used by the Hive connector. Defaults to
<code class="docutils literal"><span class="pre">None</span></code>,  which means that no Hive connector is provisioned.</td>
<td>AWS Glue Data catalog</td>
</tr>
<tr class="row-even"><td>ExternalMetastoreHost</td>
<td>When external Metastore is used (see <code class="docutils literal"><span class="pre">MetastoreType</span></code> parameter), this
points to the host of the Metastore.</td>
<td>metastore.yourcompany.comfortable</td>
</tr>
<tr class="row-odd"><td>ExternalMetastorePort</td>
<td><p class="first">When external Metastore is used (see <code class="docutils literal"><span class="pre">MetastoreType</span></code> parameter), this
points to the Metastore service port number.</p>
<p>When set to <code class="docutils literal"><span class="pre">0</span></code> (the default value), default value per each metastore
type is used:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">3306</span></code> for <code class="docutils literal"><span class="pre">External</span> <span class="pre">MySQL</span> <span class="pre">RDBMS</span></code></li>
<li><code class="docutils literal"><span class="pre">5432</span></code> for <code class="docutils literal"><span class="pre">External</span> <span class="pre">PostgreSQL</span> <span class="pre">RDBMS</span></code></li>
<li><code class="docutils literal"><span class="pre">9083</span></code> for <code class="docutils literal"><span class="pre">External</span> <span class="pre">Hive</span> <span class="pre">Metastore</span> <span class="pre">Service</span></code></li>
</ul>
<p>Cannot be empty when <code class="docutils literal"><span class="pre">MetastoreType</span></code> is to either of:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">MySQL</span> <span class="pre">RDBMS</span></code></li>
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">PostgreSQL</span> <span class="pre">RDBMS</span></code></li>
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">Hive</span> <span class="pre">Metastore</span> <span class="pre">Service</span></code></li>
</ul>
</td>
<td>9083</td>
</tr>
<tr class="row-even"><td>ExternalRdbmsMetastoreUserName</td>
<td><p class="first">When external Metastore is used (see <code class="docutils literal"><span class="pre">MetastoreType</span></code> parameter), this
determines the JDBC connection user name. Cannot be empty when
<code class="docutils literal"><span class="pre">MetastoreType</span></code> is to either of:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">MySQL</span> <span class="pre">RDBMS</span></code></li>
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">PostgreSQL</span> <span class="pre">RDBMS</span></code></li>
</ul>
</td>
<td>database_user_name</td>
</tr>
<tr class="row-odd"><td>ExternalRdbmsMetastorePassword</td>
<td><p class="first">When external Metastore is used (see <code class="docutils literal"><span class="pre">MetastoreType</span></code> parameter), this
determines the JDBC connection password. Cannot be empty when
<code class="docutils literal"><span class="pre">MetastoreType</span></code> is to either of:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">MySQL</span> <span class="pre">RDBMS</span></code></li>
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">PostgreSQL</span> <span class="pre">RDBMS</span></code></li>
</ul>
</td>
<td><a class="reference external" href="mailto:jdbc_user_p&#37;&#52;&#48;55vv0rd">jdbc_user_p<span>&#64;</span>55vv0rd</a></td>
</tr>
<tr class="row-even"><td>ExternalRdbmsMetastoreDatabaseName</td>
<td><p class="first">When external Metastore is used (see <code class="docutils literal"><span class="pre">MetastoreType</span></code> parameter), this
determines the JDBC connection password. Cannot be empty when
<code class="docutils literal"><span class="pre">MetastoreType</span></code> is to either of:</p>
<ul class="last simple">
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">MySQL</span> <span class="pre">RDBMS</span></code></li>
<li><code class="docutils literal"><span class="pre">External</span> <span class="pre">PostgreSQL</span> <span class="pre">RDBMS</span></code></li>
</ul>
</td>
<td>hivemetastore</td>
</tr>
<tr class="row-odd"><td>AdditionalCoordinatorConfigurationURI</td>
<td>URI of S3 zip file with additional configuration for the coordinator
(Optional)</td>
<td>s3://my_bucket/presto-additional-coordinator-configuration-1.0.zip</td>
</tr>
<tr class="row-even"><td>AdditionalWorkersConfigurationURI</td>
<td>URI of S3 zip file with additional configuration for the workers
(Optional)</td>
<td>s3://my_bucket/presto-additional-workers-configuration-1.0.zip</td>
</tr>
<tr class="row-odd"><td>BootstrapScriptURI</td>
<td>URI of a bash script stored on S3 to execute on all nodes.
(Optional). More information is <a class="reference internal" href="#aws-bootstrap-script"><span class="std std-ref">available in the dedicated section</span></a>.</td>
<td>s3://my_bucket/presto-bootstrap-1.0.sh</td>
</tr>
<tr class="row-even"><td>LicenseURI</td>
<td>URI of the <a class="reference internal" href="../installation/license-requirements.html"><span class="doc">Starburst Enterprise Presto license</span></a> in S3. This is only needed when
deploying the CFT (using a privately shared Starburst Enterprise Presto
AMI) without subscribing to the AWS Marketplace.</td>
<td>s3://my_bucket/signed.license</td>
</tr>
<tr class="row-odd"><td>S3Endpoint</td>
<td>URI to AWS S3-compatible endpoint  (Optional)</td>
<td><a class="reference external" href="https://mybucket.s3-us-west-2.amazonaws.com">https://mybucket.s3-us-west-2.amazonaws.com</a></td>
</tr>
<tr class="row-even"><td>S3AccessKey</td>
<td>Access key to AWS S3-compatible storage  (Optional)</td>
<td>AKIAIOSFODNN7EXAMPLE</td>
</tr>
<tr class="row-odd"><td>S3SecretKey</td>
<td>Access secret to AWS S3-compatible storage (Optional)</td>
<td>wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY</td>
</tr>
<tr class="row-even"><td>EnableCloudWatchMetrics</td>
<td>Enable integration with CloudWatch metrics. When enabled, OS and Presto
metrics are reported for each cluster node. Additionally, a CloudWatch
Dashboard with cluster overview is created. Additional CloudWatch fees are
charged.</td>
<td>no</td>
</tr>
</tbody>
</table>
<p>For a more detailed description on the above parameters, please refer to the
<a class="reference internal" href="prerequisites.html"><span class="doc">Prerequisites</span></a> section. Also, parameter values need to be provided
on the command line in special form. Please refer to the example below for
guidance.</p>
<p><strong>6. Options</strong></p>
<blockquote>
<div><p>Rollback:</p>
<p>Set rollback ability to true to disable rollback of the cluster, if stack
creation fails.</p>
</div></blockquote>
<div class="highlight-none"><div class="highlight"><pre><span></span>--disable-rollback
--no-disable-rollback
</pre></div>
</div>
<div class="highlight-properties"><div class="highlight"><pre><span></span><span class="na">RollbackTriggers</span><span class="o">=</span><span class="s">[{Arn=string,Type=string},{Arn=string,Type=string}],MonitoringTimeInMinutes=integer</span>
</pre></div>
</div>
<p><strong>7. IAM Capabilities</strong></p>
<blockquote>
<div>Analogous to how you mark the <em>I acknowledge that AWS CloudFormation might
create IAM resources.</em> checkbox, when deploying Presto via the AWS Web
Console, you need to denote that you accept this capability when deploying
with the CLI. This is done by adding a <code class="docutils literal"><span class="pre">--capabilities</span></code> parameter to the AWS
CLI <code class="docutils literal"><span class="pre">create-stack</span></code> command.</div></blockquote>
<div class="highlight-none"><div class="highlight"><pre><span></span>--capabilities CAPABILITY_IAM
</pre></div>
</div>
<dl class="docutils">
<dt><strong>8. Review</strong></dt>
<dd>Finally, review the details of your cluster and your commands. When ready,
proceed by pressing enter to conclude the creation of your Presto cluster.</dd>
</dl>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">#</a></h3>
<p>See the following create-stacks command as a reference for your Presto cluster
deployment:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>aws cloudformation create-stack \
--stack-name &quot;Presto-cluster&quot; \
--template-url &quot;https://s3.amazonaws.com/awsmp-fulfillment-cf-templates-prod/PrestoCFT.template&quot; \
--parameters \
&quot;ParameterKey=VPC,ParameterValue=vpc-4bd6ca11&quot; \
&quot;ParameterKey=Subnet,ParameterValue=subnet-123abc2b&quot; \
&quot;ParameterKey=SecurityGroups,ParameterValue=sg-12e34aeb&quot; \
&quot;ParameterKey=CoordinatorInstanceType,ParameterValue=r4.xlarge&quot; \
&quot;ParameterKey=WorkersInstanceType,ParameterValue=r4.xlarge&quot; \
&quot;ParameterKey=KeyName,ParameterValue=john.smith&quot; \
&quot;ParameterKey=IamInstanceProfile,ParameterValue=my-ec2-instance-profile&quot; \
&quot;ParameterKey=WorkersCount,ParameterValue=2&quot; \
&quot;ParameterKey=LaunchSuperset,ParameterValue=yes&quot; \
&quot;ParameterKey=AllowExternalAccessOnHttp,ParameterValue=no&quot; \
&quot;ParameterKey=MetastoreType,ParameterValue=&#39;External MySQL RDBS&#39;&quot; \
&quot;ParameterKey=ExternalMetastoreHost,ParameterValue=172.31.6.18&quot;  \
&quot;ParameterKey=ExternalMetastorePort,ParameterValue=3306&quot;  \
&quot;ParameterKey=ExternalRdbmsMetastoreUserName,ParameterValue=hive&quot;  \
&quot;ParameterKey=ExternalRdbmsMetastorePassword,ParameterValue=&#39;q@55vv0r|&gt;&#39;&quot;  \
&quot;ParameterKey=ExternalRdbmsMetastoreDatabaseName,ParameterValue=hive_metastore&quot;  \
&quot;ParameterKey=AdditionalCoordinatorConfigurationURI,ParameterValue=s3://my_bucket/presto-additional-coordinator-configuration-1.0.zip&quot; \
&quot;ParameterKey=AdditionalWorkersConfigurationURI,ParameterValue=s3://my_bucket/presto-additional-workers-configuration-1.0.zip&quot; \
&quot;ParameterKey=BootstrapScriptURI,ParameterValue=s3://my_bucket/presto-bootstrap-1.0.sh&quot; \
&quot;ParameterKey=LicenseURI,ParameterValue=s3://my_bucket/signed.license&quot; \
&quot;ParameterKey=S3Endpoint,ParameterValue=https://mybucket.s3-us-west-2.amazonaws.com&quot; \
&quot;ParameterKey=S3AccessKey,ParameterValue=AKIAIOSFODNN7EXAMPLE&quot; \
&quot;ParameterKey=S3SecretKey,ParameterValue=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY&quot; \
--capabilities CAPABILITY_IAM
</pre></div>
</div>
<p>The above commands yields output like the following:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>{
  &quot;StackId&quot;:&quot;arn:aws:cloudformation:us-east-1:123456789012:stack/myteststack/466df9e0-0dff-08e3-8e2f-5088487c4896&quot;
}
</pre></div>
</div>
</div>
</div>
<div class="section" id="permissions-required-for-deployment">
<h2><a class="toc-backref" href="#id5">Permissions Required for Deployment</a><a class="headerlink" href="#permissions-required-for-deployment" title="Permalink to this headline">#</a></h2>
<p>A user launching a CloudFormation Stack, whether via the AWS Web Console or AWS
CLI, needs to have a set of permissions that allow the creation of all necessary
stack resources. Please see the <a class="reference internal" href="prerequisites.html#aws-security-prereq-cft"><span class="std std-ref">IAM Role Permissions for CloudFormation</span></a> section for
details.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="configuration.html" style="box-shadow: none; border: none;" class="btn btn-neutral float-right" title="4.5. Configuring Presto" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="prerequisites.html" style="box-shadow: none; border: none;" class="btn btn-neutral" title="4.3. Prerequisites" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'332',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  false
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>