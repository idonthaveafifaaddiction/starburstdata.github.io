===============
Release 0.195-t
===============

General Changes
---------------

* Introduce cost-based plan optimizations.
* Replace ``distributed_join`` session property with ``join_distribution_type``.
* Replace ``reorder_joins`` session property with ``join_reordering_strategy``.
* Introduce distributed sort.
  It is now possible to turn on distributed sort via experimental ``distributed_sort`` session property
  (off by default). Distributed sort will help in cases when sorted data doesn't fit on a single node.
  Performance improvement can be expected, but partially distributed data streams are still
  merged on a single node.
* Fix sort memory leak.
* Add support for ROLE management including CREATE ROLE, DROP ROLE, GRANT ROLE, REVOKE ROLE, SET ROLE,
  SHOW CURRENT ROLES, SHOW ROLES and SHOW ROLE GRANTS commands.
* Support prepared statements that are longer than 4K bytes.
* Support predicate pushdown for the `<column> IN <values list>` predicate
  where values in the values list require casting to match the type of the column.
* Improve predicate inferring/pushdown between source and filtering subquery
  for queries like ``SELECT ... WHERE <symbol> IN <subquery>``.

Hive Connector Changes
----------------------

* Allow partitions without files for bucketed tables (via ``hive.empty-bucketed-partitions.enabled``).
* Fix issue "Hive table is corrupt. It is declared as being bucketed, but the files do not match the bucketing declaration.
  The number of files in the directory (1) does not match the declared by fixing support for Hive bucketed tables."
  See option ``hive.multi-file-bucketing.enabled`` in the Presto Hive connector documentation.
* Allow reading incompletely bucketed tables with missing files (via ``hive.empty-bucketed-partitions.enabled``).
* Allow disabling ability to create external tables from Presto (via ``hive.non-managed-table-creates-enabled``).
* Switch Avro InstanceCache to use size-based expiration.
* Add support for creating Avro Hive tables with schema set using the `avro_schema_url` table property.
* Support for backward compatible Avro schema evolution.
* Add support for HDFS wire encryption.
* Implement ROLE management support.

Kafka Connector Changes
-----------------------

* Support for Avro formatted Kafka messages.
* Support for backward compatible Avro schema evolution.
* Extend validation of tables configuration. More misconfiguration errors are detected on Presto startup during
  connector initialization and reported to user.
* Harden input checks in decoders. If message Kafka message cannot be converted to requested Presto
  type, exception will be thrown. Documentation was extended to be precise about allowed decoding rules.
* Do not skip topic partitions for which leader is not present at query time.
  Report an error if such situation arises.

JMX Connector changes
---------------------

* Add wildcard character `*` which allows to query several MBeans data with single query.

Security changes
----------------

* Secured internal cluster communication over HTTPS using Kerberos or LDAP authentication
* Add a Kerberos principal rule for exact match to File Based System Access Control

Data type changes
-----------------

* ``TIMESTAMP`` semantic changes (see :doc:`/language/time`)
* The ``current_time`` and ``localtime`` functions were fixed to return the correct value for non-UTC timezones.
* ``DECIMAL`` is the default type for non-integral number literals.
* Fix decimal precision of ``round(x, d)`` when ``x`` is a ``DECIMAL``.
* Fix returned value from ``round(x, d)`` when ``x`` is a ``DECIMAL`` with
  scale ``0`` and ``d`` is a negative integer. Previously, no rounding was done
  in this case.

SPI Changes
-----------

* Add list of projection columns to the SPI for ``ConnectorSplitManager``
